<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>rex.com - SAP Fiori Launchpad</title>
    
    <!-- SAP Horizon Theme Variables - Authentic Design Tokens -->
    <style>
        /* SAP 72 Font Implementation */
        @font-face {
            font-family: "72";
            src: url("https://ui5.sap.com/resources/sap/ui/core/themes/sap_horizon_dark/fonts/72-Regular.woff2") format("woff2");
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: "72";
            src: url("https://ui5.sap.com/resources/sap/ui/core/themes/sap_horizon_dark/fonts/72-Bold.woff2") format("woff2");
            font-weight: 700;
            font-style: normal;
        }

        /* SAP Icon Font */
        @font-face {
            font-family: "SAP-icons";
            src: url("https://ui5.sap.com/resources/sap/ui/core/themes/sap_horizon_dark/fonts/SAP-icons.woff2") format("woff2");
        }

        :root {
            /* Brand Colors */
            --sapBrandColor: #0070f3;
            --sapHighlightColor: #0070f3;
            --sapBaseColor: #fff;
            --sapShellColor: #354a5f;
            --sapBackgroundColor: #f7f7f7;
            --sapFontFamily: "72", "72full", Arial, Helvetica, sans-serif;
            --sapFontSize: 0.875rem;
            --sapFontLargeSize: 1rem;
            --sapFontSmallSize: 0.75rem;
            --sapFontHeader1Size: 1.625rem;
            --sapFontHeader2Size: 1.375rem;
            --sapFontHeader3Size: 1.125rem;
            --sapFontHeader4Size: 1rem;
            --sapFontHeader5Size: 0.875rem;
            --sapFontHeader6Size: 0.75rem;
            
            /* Spacing */
            --sapContent_ElementHeight: 2.25rem;
            --sapContent_ElementHeight_Compact: 1.625rem;
            --sapContent_ElementHeight_Condensed: 1.5rem;
            
            /* SAP Evening Horizon Shadows */
            --sapContent_Shadow0: 0 0 0 1px rgba(169,180,190,0.1);
            --sapContent_Shadow1: 0 0.125rem 0.5rem 0 rgba(0,0,0,0.3);
            --sapContent_Shadow2: 0 0.625rem 2rem 0 rgba(0,0,0,0.4);
            --sapContent_Shadow3: 0 1.25rem 5rem 0 rgba(0,0,0,0.5);
            
            /* Border Radius */
            --sapElement_BorderCornerRadius: 0.375rem;
            --sapButton_BorderCornerRadius: 0.25rem;
            --sapField_BorderCornerRadius: 0.25rem;
            
            /* SAP Evening Horizon Semantic Colors */
            --sapErrorColor: #FA6161;
            --sapWarningColor: #FFDF72;
            --sapSuccessColor: #97DD40;
            --sapInformationColor: #4DB1FF;
            --sapNeutralColor: #A9B4BE;
            
            /* SAP Evening Horizon Accent Colors */
            --sapAccentColor1: #FFDF72;
            --sapAccentColor2: #FF8CB2;
            --sapAccentColor3: #FECBDA;
            --sapAccentColor4: #FFAFED;
            --sapAccentColor5: #D3B6FF;
            --sapAccentColor6: #A6E0FF;
            --sapAccentColor7: #64EDD2;
            --sapAccentColor8: #BDE986;
            
            /* SAP Evening Horizon Grayscale */
            --sapContent_LabelColor: #8396A8;
            --sapContent_PlaceholderTextColor: #8396A8;
            --sapGroup_TitleBorderColor: #2e3742;
            --sapList_BorderColor: #2e3742;
            --sapList_TableGroupHeaderBackground: #171B21;
        }
        
        /* SAP Fiori Shell Styling */
        .sapUiBody {
            font-family: var(--sapFontFamily);
            font-size: var(--sapFontSize);
            background-color: var(--sapBackgroundColor);
            color: var(--sapTextColor);
            margin: 0;
            padding: 0;
        }
        
        /* SAP Fiori Shell Header */
        .sapMShellHeader {
            background: var(--sapShell_Background);
            background-image: var(--sapShell_BackgroundImage);
            border-bottom: 1px solid var(--sapShell_BorderColor);
            color: var(--sapShell_TextColor);
            box-shadow: var(--sapContent_Shadow1);
        }
        
        /* SAP Fiori Content Area */
        .sapMShellContent {
            background-color: var(--sapBackgroundColor);
            padding: var(--sapContent_Padding);
        }
        
        /* SAP Fiori Page Header */
        .sapMPageHeader {
            background-color: var(--sapPageHeader_Background);
            border-bottom: 1px solid var(--sapPageHeader_BorderColor);
            color: var(--sapPageHeader_TextColor);
        }
        
        /* SAP Fiori Typography Classes */
        .sapMTitle {
            font-family: var(--sapFontFamily);
            font-weight: 400;
            color: var(--sapShell_TextColor);
        }
        
        .sapMText {
            font-family: var(--sapFontFamily);
            color: var(--sapTextColor);
        }
        
        /* SAP Evening Horizon Splash Screen */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #4DB1FF;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
        }
        
        #splashScreen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .splash-logo {
            font-family: var(--sapFontFamily);
            font-size: 4rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin-bottom: 1rem;
            animation: logoFadeIn 1.5s ease-out;
        }
        
        .splash-subtitle {
            font-family: var(--sapFontFamily);
            font-size: 1.5rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            animation: subtitleSlideUp 1.8s ease-out 0.3s both;
        }
        
        .splash-loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 2rem;
        }
        
        @keyframes logoFadeIn {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        @keyframes subtitleSlideUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* SAP Icon Font Implementation */
        .sapUiIcon {
            font-family: "SAP-icons";
            font-style: normal;
            font-weight: normal;
            speak: none;
            display: inline-block;
            text-decoration: inherit;
            text-align: center;
        }

        /* Typography Classes */
        .sapUiText {
            font-family: var(--sapFontFamily);
            font-size: var(--sapFontSize);
            color: var(--sapTextColor);
            line-height: 1.4;
        }

        .sapUiTitle {
            font-family: var(--sapFontFamily);
            font-weight: 400;
            color: var(--sapTitleColor);
        }

        .sapUiTitleH1 { font-size: var(--sapFontHeader1Size); }
        .sapUiTitleH2 { font-size: var(--sapFontHeader2Size); }
        .sapUiTitleH3 { font-size: var(--sapFontHeader3Size); }

        /* SAP Fiori Generic Tile */
        .sapMGT {
            background: var(--sapTile_Background);
            border: 1px solid var(--sapTile_BorderColor);
            border-radius: 0.375rem;
            box-shadow: var(--sapContent_Shadow0);
            transition: all 0.1s ease-in-out;
            font-family: var(--sapFontFamily);
        }

        .sapMGT:hover {
            box-shadow: var(--sapContent_Shadow1);
            border-color: var(--sapHighlightColor);
        }

        .sapMGT:active {
            box-shadow: var(--sapContent_Shadow0);
            transform: scale(0.98);
        }

        .sapMGT .sapMGTHdrTxt {
            color: var(--sapTile_TitleTextColor);
            font-size: var(--sapFontSize);
            font-weight: 400;
            line-height: 1.4;
        }

        .sapMGT .sapMGTSubHdrTxt {
            color: var(--sapNeutralColor);
            font-size: var(--sapFontSmallSize);
            line-height: 1.4;
        }

        /* Authentic SAP Shell Bar */
        .sapUshellShell {
            background: var(--sapShellColor);
            height: 44px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .sapUshellShellHead {
            background: var(--sapShellColor);
            box-shadow: 0 1px 4px rgba(0,0,0,0.15);
        }

        .sapUshellShellHeadTitle {
            color: #fff;
            font-family: var(--sapFontFamily);
            font-size: var(--sapFontLargeSize);
            font-weight: 400;
        }

        /* SAP Fiori State Classes */
        .sapUiState-Positive { color: var(--sapPositiveColor); }
        .sapUiState-Critical { color: var(--sapCriticalColor); }
        .sapUiState-Negative { color: var(--sapNegativeColor); }
        .sapUiState-Information { color: var(--sapInformationColor); }

        /* SAP Fiori Loading Animation */
        .sapMGT[data-sap-ui-state="Loading"] .sapMGTContent::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,112,242,0.1), transparent);
            animation: sapMBusyIndicatorAnimation 1.5s infinite;
        }

        @keyframes sapMBusyIndicatorAnimation {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* SAP Fiori Responsive Breakpoints */
        @media (max-width: 599px) { /* Phone */
            .sapMTileContainer .sapMTile {
                width: calc(50% - 0.5rem);
                margin: 0.25rem;
            }
        }

        @media (min-width: 600px) and (max-width: 1023px) { /* Tablet */
            .sapMTileContainer .sapMTile {
                width: calc(33.33% - 0.67rem);
                margin: 0.33rem;
            }
        }

        @media (min-width: 1024px) { /* Desktop */
            .sapMTileContainer .sapMTile {
                width: calc(25% - 0.75rem);
                margin: 0.375rem;
            }
        }
    </style>
    
    <!-- Authentic SAP Fiori Launchpad Bootstrap -->
    <script id="sap-ui-bootstrap"
            src="https://sapui5.hana.ondemand.com/resources/sap-ui-core.js"
            data-sap-ui-theme="sap_horizon_dark_hcb"
            data-sap-ui-libs="sap.m,sap.f,sap.ui.layout,sap.ushell"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-frameOptions="trusted"
            data-sap-ui-preload="async"
            data-sap-ui-xx-waitForTheme="true"
            data-sap-ui-xx-supportedLanguages="en"
            data-sap-ui-resourceroots='{
                "com.rex.trading": "./",
                "sap.fe.templates": "https://sapui5.hana.ondemand.com/resources/sap/fe/templates"
            }'>
    </script>
    
    <script>
        // SAP ushell Container Configuration
        window["sap-ushell-config"] = {
            defaultRenderer: "fiori2",
            bootstrapPlugins: {
                "RuntimeAuthoringPlugin": {
                    component: "sap.ushell.plugins.rta",
                    config: {
                        validateAppVersion: false
                    }
                }
            },
            renderers: {
                fiori2: {
                    componentData: {
                        config: {
                            enableSearch: false,
                            rootIntent: "Shell-home"
                        }
                    }
                }
            },
            services: {
                LaunchPage: {
                    adapter: {
                        config: {
                            groups: [{
                                id: "crypto_trading_group",
                                title: "rex.com Crypto Trading",
                                isPreset: true,
                                isVisible: true,
                                tiles: []
                            }]
                        }
                    }
                },
                NavTargetResolution: {
                    config: {
                        enableClientSideTargetResolution: true
                    }
                },
                ClientSideTargetResolution: {
                    adapter: {
                        config: {
                            inbounds: {}
                        }
                    }
                }
            }
        };

        // Splash Screen Control
        function hideSplashScreen() {
            setTimeout(function() {
                var splashScreen = document.getElementById('splashScreen');
                if (splashScreen) {
                    splashScreen.classList.add('hidden');
                    setTimeout(function() {
                        splashScreen.style.display = 'none';
                    }, 800); // Wait for fade out animation
                }
            }, 2500); // Show splash for 2.5 seconds
        }
        
        // Failsafe: Always hide splash screen after 4 seconds regardless of errors
        setTimeout(function() {
            var splashScreen = document.getElementById('splashScreen');
            if (splashScreen && splashScreen.style.display !== 'none') {
                splashScreen.classList.add('hidden');
                setTimeout(function() {
                    splashScreen.style.display = 'none';
                }, 800);
            }
        }, 4000);

        sap.ui.getCore().attachInit(function () {
            sap.ui.require([
                "sap/ushell/Container",
                "sap/m/GenericTile",
                "sap/m/TileContent",
                "sap/m/NumericContent",
                "sap/m/MessageToast"
            ], function(Container, GenericTile, TileContent, NumericContent, MessageToast) {
                
                // Real trading data loading functions
                function loadMarketData() {
                    fetch('/api/market/data?symbol=bitcoin')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}`);
                            }
                            return response.text();
                        })
                        .then(text => {
                            try {
                                const data = JSON.parse(text);
                                console.log('Market data loaded:', data);
                                MessageToast.show("Market data updated: $" + (data.price || 'N/A'));
                            } catch (e) {
                                console.log('Non-JSON response:', text);
                                MessageToast.show("Market data service unavailable");
                            }
                        })
                        .catch(error => {
                            console.error('Error loading market data:', error);
                            MessageToast.show("Market data service offline");
                        });
                }
                
                function loadWalletBalance() {
                    fetch('/api/wallet/balance')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}`);
                            }
                            return response.text();
                        })
                        .then(text => {
                            try {
                                const data = JSON.parse(text);
                                console.log('Wallet balance loaded:', data);
                                MessageToast.show("Wallet balance: $" + (data.balance || 'N/A'));
                            } catch (e) {
                                console.log('Non-JSON response:', text);
                                MessageToast.show("Wallet service unavailable");
                            }
                        })
                        .catch(error => {
                            console.error('Error loading wallet balance:', error);
                            MessageToast.show("Wallet service offline");
                        });
                }
                
                function loadTradingStatus() {
                    fetch('/api/trading/status')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}`);
                            }
                            return response.text();
                        })
                        .then(text => {
                            try {
                                const data = JSON.parse(text);
                                console.log('Trading status loaded:', data);
                                MessageToast.show("Trading status: " + (data.status || 'Unknown'));
                            } catch (e) {
                                console.log('Non-JSON response:', text);
                                MessageToast.show("Trading service unavailable");
                            }
                        })
                        .catch(error => {
                            console.error('Error loading trading status:', error);
                            MessageToast.show("Trading service offline");
                        });
                }
                
                // Real-time data loading without OData dependency
                console.log("Initializing real-time crypto trading data...");
                
                // Create authentic SAP Fiori Launchpad without ushell Container dependency
                console.log("Creating authentic SAP Fiori Launchpad with fallback shell...");
                createFallbackShell();
                
                function createFallbackShell() {
                    console.log("SAP ushell not available, creating fallback shell...");
                    
                    console.log("SAP Fiori tiles initialized successfully");
                }
                
                // Create fallback shell UI
                sap.ui.require([
                    "sap/f/ShellBar",
                    "sap/m/App",
                    "sap/m/Page",
                    "sap/ui/layout/VerticalLayout",
                    "sap/m/Text",
                    "sap/m/Button",
                    "sap/m/Avatar"
                ], function(ShellBar, App, Page, VerticalLayout, Text, Button, Avatar) {
                        
                        // Create SAP Fiori ShellBar with authentic design
                        var oShellBar = new ShellBar("shellBar", {
                            title: "rex.com",
                            secondTitle: "Crypto Trading Platform",
                            homeIcon: "sap-icon://home",
                            showMenuButton: true,
                            showNavButton: false,
                            showCopilot: false,
                            showSearch: true,
                            showNotifications: true,
                            showProductSwitcher: true,
                            notificationsNumber: "3",
                            profile: new Avatar({
                                initials: "T",
                                backgroundColor: "Accent1"
                            }),
                            menuButtonPressed: function() {
                                MessageToast.show("Menu opened");
                            },
                            homeIconPressed: function() {
                                MessageToast.show("Home pressed");
                                window.location.reload();
                            },
                            notificationsPressed: function() {
                                MessageToast.show("Notifications: 3 new alerts");
                            },
                            productSwitcherPressed: function() {
                                MessageToast.show("Product switcher opened");
                            },
                            searchButtonPressed: function() {
                                MessageToast.show("Search activated");
                            }
                        });
                        
                        // Create authentic SAP Fiori Launchpad with TileContainer
                        sap.ui.require([
                            "sap/m/TileContainer", 
                            "sap/m/StandardTile"
                        ], function(TileContainer, StandardTile) {
                            
                            var oTileContainer = new TileContainer("mainTileContainer", {
                                tiles: [
                                    new StandardTile({
                                        title: "Bitcoin Trading",
                                        info: "Loading...",
                                        infoState: sap.ui.core.ValueState.None,
                                        icon: "sap-icon://BusinessSuiteInAppSymbols/icon-analytics",
                                        type: "Monitor",
                                        press: function() {
                                            loadMarketData();
                                            MessageToast.show("Loading Bitcoin market data...");
                                        }
                                    }),
                                    
                                    new StandardTile({
                                        title: "Wallet",
                                        info: "Connect",
                                        infoState: sap.ui.core.ValueState.None, 
                                        icon: "sap-icon://wallet",
                                        type: "Create",
                                        press: function() {
                                            loadWalletBalance();
                                            MessageToast.show("Connecting wallet...");
                                        }
                                    }),
                                    
                                    new StandardTile({
                                        title: "Trading Console",
                                        info: "Ready",
                                        infoState: sap.ui.core.ValueState.Success,
                                        icon: "sap-icon://BusinessSuiteInAppSymbols/icon-trade",
                                        type: "Create",
                                        press: function() {
                                            openTradingConsole();
                                        }
                                    }),
                                    
                                    new StandardTile("aiSignalsTile", {
                                        title: "AI Signals",
                                        info: "Loading...",
                                        infoState: sap.ui.core.ValueState.None,
                                        icon: "sap-icon://lightbulb",
                                        type: "Monitor",
                                        press: function() {
                                            loadAISignals();
                                        }
                                    }),
                                    
                                    new StandardTile({
                                        title: "Strands Agents",
                                        info: "Manage",
                                        infoState: sap.ui.core.ValueState.Information,
                                        icon: "sap-icon://collaborate",
                                        type: "Create",
                                        press: function() {
                                            openStrandsAgentConsole();
                                        }
                                    }),
                                    
                                    new StandardTile("agentMonitorTile", {
                                        title: "Agent Monitor",
                                        info: "Loading...",
                                        infoState: sap.ui.core.ValueState.None,
                                        icon: "sap-icon://monitor-payments",
                                        type: "Monitor",
                                        press: function() {
                                            loadAgentStatus();
                                        }
                                    })
                                ]
                            });
                            
                            // Create main page with authentic SAP Fiori Launchpad layout
                            var oPage = new Page("launchpadPage", {
                                customHeader: oShellBar,
                                content: [oTileContainer],
                                enableScrolling: true,
                                showNavButton: false,
                                backgroundDesign: "Solid"
                            });
                            
                            // Create App container
                            var oApp = new App("app", {
                                pages: [oPage]
                            });
                            
                            // Place app in DOM
                            oApp.placeAt("content");
                            
                            // Auto-load initial data
                            setTimeout(function() {
                                loadMarketData();
                            }, 2000);
                            
                            MessageToast.show("SAP Fiori Launchpad initialized with authentic TileContainer");
                            
                            // Hide splash screen after launchpad is ready
                            hideSplashScreen();
                            
                            // Load real data for tiles
                            setTimeout(loadTileData, 1000);
                        });
                    });
                });
        
        function openTradingConsole() {
            window.open('/trading', '_blank');
        }
        
        function openStrandsAgentConsole() {
            loadStrandsAgentUI();
        }
        
        function loadAgentStatus() {
            fetch('/api/agents/status')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    try {
                        const data = JSON.parse(text);
                        console.log('Agent status loaded:', data);
                        showAgentStatusDialog(data);
                    } catch (e) {
                        console.log('Non-JSON response:', text);
                        MessageToast.show("Agent monitoring service unavailable");
                    }
                })
                .catch(error => {
                    console.error('Error loading agent status:', error);
                    MessageToast.show("Agent monitoring offline");
                });
        }
        
        function loadStrandsAgentUI() {
            sap.ui.require([
                "sap/m/Dialog",
                "sap/m/Table",
                "sap/m/Column",
                "sap/m/ColumnListItem",
                "sap/m/Text",
                "sap/m/Button",
                "sap/m/ObjectStatus",
                "sap/m/VBox",
                "sap/m/HBox",
                "sap/m/Input",
                "sap/m/Select",
                "sap/ui/core/Item"
            ], function(Dialog, Table, Column, ColumnListItem, Text, Button, ObjectStatus, VBox, HBox, Input, Select, Item) {
                
                // Create strands agent management dialog
                var oDialog = new Dialog("strandsAgentDialog", {
                    title: "Strands Agent Management",
                    contentWidth: "80%",
                    contentHeight: "70%",
                    verticalScrolling: false,
                    content: [
                        new VBox({
                            width: "100%",
                            items: [
                                // Control panel
                                new HBox({
                                    width: "100%",
                                    justifyContent: "SpaceBetween",
                                    alignItems: "Center",
                                    items: [
                                        new Text({
                                            text: "Active Strands Agents",
                                            class: "sapUiMediumMargin"
                                        }),
                                        new HBox({
                                            items: [
                                                new Button({
                                                    text: "Create Agent",
                                                    type: "Emphasized",
                                                    icon: "sap-icon://add",
                                                    press: function() {
                                                        showCreateAgentDialog();
                                                    }
                                                }),
                                                new Button({
                                                    text: "Refresh",
                                                    icon: "sap-icon://refresh",
                                                    press: function() {
                                                        refreshAgentTable();
                                                    }
                                                })
                                            ]
                                        })
                                    ]
                                }),
                                
                                // Agent table
                                new Table("agentTable", {
                                    width: "100%",
                                    columns: [
                                        new Column({
                                            header: new Text({text: "Agent ID"})
                                        }),
                                        new Column({
                                            header: new Text({text: "Type"})
                                        }),
                                        new Column({
                                            header: new Text({text: "Status"})
                                        }),
                                        new Column({
                                            header: new Text({text: "Capabilities"})
                                        }),
                                        new Column({
                                            header: new Text({text: "Actions"})
                                        })
                                    ],
                                    items: []
                                })
                            ]
                        })
                    ],
                    beginButton: new Button({
                        text: "Close",
                        press: function() {
                            oDialog.close();
                        }
                    })
                });
                
                oDialog.open();
                loadAgentData();
            });
        }
        
        function loadAgentData() {
            // Load agent data from API
            fetch('/api/agents/list')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    try {
                        const agents = JSON.parse(text);
                        populateAgentTable(agents);
                    } catch (e) {
                        console.error('Failed to parse agent data:', e);
                        MessageToast.show("Failed to load agent data");
                        populateAgentTable([]);
                    }
                })
                .catch(error => {
                    console.error('Error loading agent data:', error);
                    MessageToast.show("Agent service unavailable");
                    populateAgentTable([]);
                });
        }
        
        
        function populateAgentTable(agents) {
            sap.ui.require([
                "sap/m/ColumnListItem",
                "sap/m/Text",
                "sap/m/ObjectStatus",
                "sap/m/Button",
                "sap/m/HBox"
            ], function(ColumnListItem, Text, ObjectStatus, Button, HBox) {
                
                var oTable = sap.ui.getCore().byId("agentTable");
                if (!oTable) return;
                
                oTable.removeAllItems();
                
                agents.forEach(function(agent) {
                    var statusState = agent.status === "active" ? "Success" : "Error";
                    
                    var oItem = new ColumnListItem({
                        cells: [
                            new Text({text: agent.agent_id}),
                            new Text({text: agent.agent_type}),
                            new ObjectStatus({
                                text: agent.status,
                                state: statusState
                            }),
                            new Text({text: agent.capabilities.join(", ")}),
                            new HBox({
                                items: [
                                    new Button({
                                        text: "View",
                                        type: "Transparent",
                                        icon: "sap-icon://detail-view",
                                        press: function() {
                                            showAgentDetails(agent);
                                        }
                                    }),
                                    new Button({
                                        text: agent.status === "active" ? "Stop" : "Start",
                                        type: "Transparent",
                                        icon: agent.status === "active" ? "sap-icon://stop" : "sap-icon://play",
                                        press: function() {
                                            toggleAgentStatus(agent);
                                        }
                                    })
                                ]
                            })
                        ]
                    });
                    
                    oTable.addItem(oItem);
                });
            });
        }
        
        function showAgentDetails(agent) {
            sap.ui.require([
                "sap/m/Dialog",
                "sap/m/VBox",
                "sap/m/Label",
                "sap/m/Text",
                "sap/m/Button"
            ], function(Dialog, VBox, Label, Text, Button) {
                
                var oDetailsDialog = new Dialog({
                    title: "Agent Details: " + agent.agent_id,
                    contentWidth: "50%",
                    content: [
                        new VBox({
                            items: [
                                new Label({text: "Agent ID:"}),
                                new Text({text: agent.agent_id, class: "sapUiSmallMarginBottom"}),
                                
                                new Label({text: "Type:"}),
                                new Text({text: agent.agent_type, class: "sapUiSmallMarginBottom"}),
                                
                                new Label({text: "Status:"}),
                                new Text({text: agent.status, class: "sapUiSmallMarginBottom"}),
                                
                                new Label({text: "Model Provider:"}),
                                new Text({text: agent.model_provider, class: "sapUiSmallMarginBottom"}),
                                
                                new Label({text: "Capabilities:"}),
                                new Text({text: agent.capabilities.join(", "), class: "sapUiSmallMarginBottom"})
                            ]
                        })
                    ],
                    beginButton: new Button({
                        text: "Close",
                        press: function() {
                            oDetailsDialog.close();
                        }
                    })
                });
                
                oDetailsDialog.open();
            });
        }
        
        function toggleAgentStatus(agent) {
            var newStatus = agent.status === "active" ? "inactive" : "active";
            var action = newStatus === "active" ? "start" : "stop";
            
            fetch(`/api/agents/${agent.agent_id}/${action}`, {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    MessageToast.show(`Agent ${agent.agent_id} ${action}ed successfully`);
                    agent.status = newStatus;
                    populateAgentTable([agent]);
                } else {
                    MessageToast.show(`Failed to ${action} agent ${agent.agent_id}`);
                }
            })
            .catch(error => {
                console.error(`Error ${action}ing agent:`, error);
                MessageToast.show(`Failed to ${action} agent`);
            });
        }
        
        function refreshAgentTable() {
            loadAgentData();
            MessageToast.show("Agent data refreshed");
        }
        
        function showCreateAgentDialog() {
            sap.ui.require([
                "sap/m/Dialog",
                "sap/m/VBox",
                "sap/m/Label",
                "sap/m/Input",
                "sap/m/Select",
                "sap/ui/core/Item",
                "sap/m/Button"
            ], function(Dialog, VBox, Label, Input, Select, Item, Button) {
                
                var oCreateDialog = new Dialog({
                    title: "Create New Strands Agent",
                    contentWidth: "50%",
                    content: [
                        new VBox({
                            items: [
                                new Label({text: "Agent ID:"}),
                                new Input("newAgentId", {placeholder: "Enter unique agent ID"}),
                                
                                new Label({text: "Agent Type:"}),
                                new Select("newAgentType", {
                                    items: [
                                        new Item({key: "historical_loader", text: "Historical Loader"}),
                                        new Item({key: "database", text: "Database Agent"}),
                                        new Item({key: "blockchain_strands", text: "Blockchain Strands"}),
                                        new Item({key: "data_management", text: "Data Management"}),
                                        new Item({key: "a2a_coordinator", text: "A2A Coordinator"})
                                    ]
                                }),
                                
                                new Label({text: "Model Provider:"}),
                                new Select("newModelProvider", {
                                    items: [
                                        new Item({key: "deepseek", text: "DeepSeek"}),
                                        new Item({key: "anthropic", text: "Anthropic"})
                                    ],
                                    selectedKey: "deepseek"
                                })
                            ]
                        })
                    ],
                    beginButton: new Button({
                        text: "Create",
                        type: "Emphasized",
                        press: function() {
                            createNewAgent();
                            oCreateDialog.close();
                        }
                    }),
                    endButton: new Button({
                        text: "Cancel",
                        press: function() {
                            oCreateDialog.close();
                        }
                    })
                });
                
                oCreateDialog.open();
            });
        }
        
        function createNewAgent() {
            var agentId = sap.ui.getCore().byId("newAgentId").getValue();
            var agentType = sap.ui.getCore().byId("newAgentType").getSelectedKey();
            var modelProvider = sap.ui.getCore().byId("newModelProvider").getSelectedKey();
            
            if (!agentId || !agentType) {
                MessageToast.show("Please fill in all required fields");
                return;
            }
            
            var agentData = {
                agent_id: agentId,
                agent_type: agentType,
                model_provider: modelProvider
            };
            
            fetch('/api/agents/create', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(agentData)
            })
            .then(response => {
                if (response.ok) {
                    MessageToast.show(`Agent ${agentId} created successfully`);
                    refreshAgentTable();
                } else {
                    MessageToast.show(`Failed to create agent ${agentId}`);
                }
            })
            .catch(error => {
                console.error('Error creating agent:', error);
                MessageToast.show("Failed to create agent");
            });
        }
        
        function showAgentStatusDialog(data) {
            MessageToast.show(`Active agents: ${data.active_count}`);
        }
        
        function loadAISignals() {
            fetch('/api/ai/signals')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    try {
                        const data = JSON.parse(text);
                        MessageToast.show(`AI Signals: ${data.active_signals} active signals detected`);
                    } catch (e) {
                        console.error('No AI signals API available:', e);
                        MessageToast.show("AI Signals service not available");
                    }
                })
                .catch(error => {
                    console.error('Error loading AI signals:', error);
                    MessageToast.show("AI Signals service offline");
                });
        }
        
        // Auto-load real data for tiles on startup
        function loadTileData() {
            // Load agent status for Agent Monitor tile
            fetch('/api/agents/status')
                .then(response => response.json())
                .then(data => {
                    // Update Agent Monitor tile
                    var agentMonitorTile = sap.ui.getCore().byId("agentMonitorTile");
                    if (agentMonitorTile) {
                        agentMonitorTile.setInfo(`${data.active_count} Active`);
                        agentMonitorTile.setInfoState(data.active_count > 0 ? "Success" : "Error");
                    }
                })
                .catch(error => {
                    console.error('Error loading tile data:', error);
                });
            
            // Load AI signals (if API exists)
            fetch('/api/ai/signals')
                .then(response => response.json())
                .then(data => {
                    var aiSignalsTile = sap.ui.getCore().byId("aiSignalsTile");
                    if (aiSignalsTile) {
                        aiSignalsTile.setInfo(`${data.active_signals || 0} Active`);
                        aiSignalsTile.setInfoState(data.active_signals > 0 ? "Warning" : "None");
                    }
                })
                .catch(error => {
                    // AI signals API doesn't exist yet, show "No Data"
                    var aiSignalsTile = sap.ui.getCore().byId("aiSignalsTile");
                    if (aiSignalsTile) {
                        aiSignalsTile.setInfo("No Data");
                        aiSignalsTile.setInfoState("None");
                    }
                });
        }
        
        // Set up periodic data refresh
        setInterval(function() {
            // Load market data periodically
            loadMarketData();
            loadWalletBalance();
            loadTradingStatus();
        }, 30000); // Update every 30 seconds
    });
    </script>
    
    <style>
        /* Authentic SAP Fiori Launchpad Styling */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: "72", "Helvetica Neue", Arial, sans-serif;
        }
        
        #content {
            height: 100%;
            background-color: #f7f7f7;
        }
        
        /* Override for proper launchpad look */
        .sapUshellShellHeader {
            background-color: #354a5f !important;
        }
        
        .sapUshellTileContainer {
            margin: 1rem !important;
        }
        
        .sapUshellTile {
            margin: 0.5rem !important;
        }
        
        /* Real-time data indicators */
        .sapUshellTileContainerContent .sapUshellTile[data-state="loading"]::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(0,112,242,0.1) 50%, transparent 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="sapUiBody">
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-logo">rex.com</div>
        <div class="splash-subtitle">Crypto Trading Platform</div>
        <div class="splash-loader"></div>
    </div>
    
    <!-- Main Content -->
    <div id="content"></div>
</body>
</html>