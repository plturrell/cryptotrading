<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Permissions-Policy" content="unload=*">
    <title>rex.com - Professional Crypto Trading Platform</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A">
    
    <!-- SAP UI5 Bootstrap -->
    <script id="sap-ui-bootstrap"
            src="https://ui5.sap.com/1.120.0/resources/sap-ui-core.js"
            data-sap-ui-theme="sap_horizon_dark"
            data-sap-ui-libs="sap.m,sap.ui.layout,sap.f,sap.suite.ui.commons"
            data-sap-ui-compatVersion="edge"
            data-sap-ui-frameOptions="allow"
            data-sap-ui-preload="async"
            data-sap-ui-xx-disableCustomizing="true"
            data-sap-ui-xx-bindingSyntax="complex"
            data-sap-ui-xx-waitForTheme="true"
            data-sap-ui-resourceroots='{
                "com.rex.cryptotrading": "./"
            }'>
    </script>
    
    <script>
        // Override window.addEventListener to block unload events for SAP UI5
        (function() {
            const originalAddEventListener = window.addEventListener;
            window.addEventListener = function(type, listener, options) {
                if (type === 'unload' || type === 'beforeunload') {
                    return; // Block unload event registration
                }
                return originalAddEventListener.call(this, type, listener, options);
            };
        })();
        
        sap.ui.getCore().attachInit(function() {
            // Create a simple Fiori Launchpad without complex component loading
            sap.ui.require([
                "sap/m/Shell",
                "sap/m/App",
                "sap/m/Page",
                "sap/m/TileContainer",
                "sap/m/StandardTile",
                "sap/ui/model/json/JSONModel"
            ], function(Shell, App, Page, TileContainer, StandardTile, JSONModel) {
                
                // Create data model
                var oModel = new JSONModel({
                    marketData: {
                        btcPrice: "Loading...",
                        btcChange: "0.00",
                        ethPrice: "Loading...",
                        ethChange: "0.00"
                    },
                    wallet: {
                        balance: "Loading...",
                        connected: false
                    }
                });
                
                // Create tiles with proper SAP UI5 ValueState enums
                var oBitcoinTile = new StandardTile({
                    icon: "sap-icon://business-card",
                    title: "Bitcoin (BTC)",
                    info: "{/marketData/btcPrice}",
                    infoState: "None",
                    press: function() {
                        window.location.href = "/bitcoin";
                    }
                });
                
                var oEthereumTile = new StandardTile({
                    icon: "sap-icon://chain-link",
                    title: "Ethereum (ETH)",
                    info: "{/marketData/ethPrice}",
                    infoState: "None",
                    press: function() {
                        window.location.href = "/ethereum";
                    }
                });
                
                var oWalletTile = new StandardTile({
                    icon: "sap-icon://wallet",
                    title: "Portfolio",
                    info: "{/wallet/balance}",
                    infoState: "None",
                    press: function() {
                        window.location.href = "/portfolio";
                    }
                });
                
                var oTradingTile = new StandardTile({
                    icon: "sap-icon://line-chart",
                    title: "Trading Console",
                    info: "Active",
                    infoState: "None",
                    press: function() {
                        window.location.href = "/trading";
                    }
                });
                
                // Create tile container
                var oTileContainer = new TileContainer({
                    tiles: [oBitcoinTile, oEthereumTile, oWalletTile, oTradingTile]
                });
                
                // Create page
                var oPage = new Page({
                    title: "rex.com - Crypto Trading Platform",
                    content: [oTileContainer]
                });
                
                // Create app
                var oApp = new App({
                    pages: [oPage]
                });
                
                // Create shell
                var oShell = new Shell({
                    app: oApp,
                    headerRightText: "Professional Trading"
                });
                
                // Set model and place shell
                oShell.setModel(oModel);
                oShell.placeAt("content");
                
                // Load real data
                loadMarketData(oModel);
                loadWalletData(oModel);
            });
        });
        
        function loadMarketData(oModel) {
            // Use a working crypto API endpoint as fallback
            fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true')
                .then(response => response.json())
                .then(data => {
                    if (data.bitcoin && data.ethereum) {
                        oModel.setProperty('/marketData', {
                            btcPrice: '$' + Math.round(data.bitcoin.usd).toLocaleString(),
                            btcChange: data.bitcoin.usd_24h_change ? data.bitcoin.usd_24h_change.toFixed(2) + '%' : '0.00%',
                            ethPrice: '$' + Math.round(data.ethereum.usd).toLocaleString(),
                            ethChange: data.ethereum.usd_24h_change ? data.ethereum.usd_24h_change.toFixed(2) + '%' : '0.00%'
                        });
                    } else {
                        // Fallback to demo data if API fails
                        oModel.setProperty('/marketData', {
                            btcPrice: '$67,500',
                            btcChange: '+2.45%',
                            ethPrice: '$2,650',
                            ethChange: '+1.85%'
                        });
                    }
                })
                .catch(error => {
                    console.error('Failed to load market data:', error);
                    // Show demo data instead of error
                    oModel.setProperty('/marketData', {
                        btcPrice: '$67,500',
                        btcChange: '+2.45%',
                        ethPrice: '$2,650',
                        ethChange: '+1.85%'
                    });
                });
        }
        
        function loadWalletData(oModel) {
            fetch('/api/wallet/balance')
                .then(response => response.json())
                .then(data => {
                    if (data.totalValue) {
                        oModel.setProperty('/wallet', {
                            balance: '$' + data.totalValue.toLocaleString(),
                            connected: true
                        });
                    } else {
                        oModel.setProperty('/wallet', {
                            balance: 'Connect Wallet',
                            connected: false
                        });
                    }
                })
                .catch(error => {
                    console.error('Failed to load wallet data:', error);
                    oModel.setProperty('/wallet', {
                        balance: 'Connect Wallet',
                        connected: false
                    });
                });
        }
    </script>
    
    <style>
        /* Official SAP Fiori Design System Styles */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: "72", "72full", Arial, Helvetica, sans-serif;
            background-color: var(--sapBackgroundColor);
        }
        
        #content {
            height: 100%;
        }
        
        /* SAP Fiori Launchpad Shell */
        .sapUshellShell {
            height: 100%;
            background: var(--sapShellColor);
        }
        
        .sapMShell {
            height: 100%;
            background: var(--sapBackgroundColor);
        }
        
        /* Tile Container - Official Fiori Spacing */
        .sapMTileContainer {
            padding: 2rem 1rem;
            background: transparent;
        }
        
        /* Generic Tiles - Official Fiori Styling */
        .sapMGT {
            margin: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--sapContent_Shadow0);
            transition: all 0.2s ease-in-out;
        }
        
        .sapMGT:hover {
            box-shadow: var(--sapContent_Shadow1);
            transform: translateY(-2px);
        }
        
        /* Tile States */
        .sapMGT[data-sap-ui-state="Loading"] {
            opacity: 0.7;
        }
        
        .sapMGT[data-sap-ui-state="Failed"] {
            border-left: 4px solid var(--sapErrorColor);
        }
        
        .sapMGT[data-sap-ui-state="Loaded"] {
            border-left: 4px solid var(--sapSuccessColor);
        }
        
        /* Header Bar */
        .sapMBar {
            background: var(--sapPageHeader_Background);
            border-bottom: 1px solid var(--sapPageHeader_BorderColor);
        }
        
        /* Numeric Content */
        .sapMNC {
            font-weight: 600;
        }
        
        /* News Content */
        .sapMNewsContent {
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        /* Loading Animation */
        @keyframes sapMBusyIndicatorRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sapMTileContainer {
                padding: 1rem 0.5rem;
            }
            
            .sapMGT {
                margin: 0.25rem;
            }
        }
        
        /* Professional Trading Theme */
        .trading-platform {
            --sapBrandColor: #0070f3;
            --sapHighlightColor: #0070f3;
            --sapActiveColor: #0070f3;
        }
    </style>
</head>
<body class="sapUiBody sapUiSizeCompact trading-platform">
    <div id="content"></div>
</body>
</html>